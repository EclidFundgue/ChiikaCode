# ChiikaCode 用户手册

## 1. 前言

### 1.1 **编写目的**

本用户手册旨在帮助用户了解并正确使用 **ChiikaCode** 项目的全部功能。
手册详细介绍了软件的安装、配置、使用方法以及使用时的注意事项。通过阅读本手册，用户可以熟练操作 ChiikaCode 并充分发挥其在编程过程中的代码辅助能力。
本手册的目标读者为：
使用 Visual Studio Code 进行开发的程序员；
希望利用智能代码辅助工具提升工作效率的开发者；
希望在日常编码中获得更精准代码生成、优化建议和即时问答支持的用户。

### 1.2 **项目背景**

**ChiikaCode** 是由 **Chiikawa组** 自主研发的智能代码辅助工具。项目的初衷是为开发者提供一个全面而灵活的工具，以提高编码效率和代码质量。  
该项目由Chiikawa组负责开发和维护，旨在通过检索增强生成（RAG）来构建软件开发全生命周期的工程级代码智能助手，实现基于大模型问答的智能化开发运维模式。  
通过 **ChiikaCode**，开发者能够轻松获得代码补全、优化建议等功能，不仅提升了开发效率，还能确保代码的质量和可维护性。

### 1.3 **定义**

- **ChiikaCode**：本项目名称，包括 VSCode 插件和 Web 前端两部分。
- **VSCode 插件**：Visual Studio Code 的扩展程序，提供代码辅助和聊天功能。
- **RAG（Retrieval-Augmented Generation）**：检索增强生成，用于项目级别代码生成的方法。通过检索已有的代码库、文档和知识，结合生成模型进行代码生成，从而提供更高质量、更符合需求的代码输出。
- **本地模型**：在用户本地环境中运行的 AI 模型，实现离线代码辅助功能。支持用户在没有网络连接的情况下进行代码生成和优化。
- **大语言模型 API**：在线 API，提供远程代码辅助功能。

### 1.4 **参考资料**

- **a.** Visual Studio Code 插件开发指南，微软公司，最新版。该指南介绍了如何使用 Visual Studio Code 的扩展 API 来开发插件，提供了插件开发的基础文档。
- **b.** RAG 检索增强生成技术指南，详细讲解了 RAG 技术的工作原理，尤其是如何通过知识检索和生成模型的结合来提升生成代码的质量和准确性。
- **c.** 开源大语言模型部署指南，提供在本地环境中部署开源大语言模型（如 GPT、LLaMA 等）的步骤及注意事项，以确保本地模型的有效运行。
- **d.** Python 编码标准与代码质量提升指南，由 Python 社区提供，描述了代码质量提升的最佳实践，帮助开发者编写更加结构清晰、性能优化的代码。
- **e.** 大模型集成及推理框架，探讨了如何将大模型集成到代码辅助工具链中，包括常见推理框架（如 vLLM、DeepSpeed）在大模型部署中的作用。
- **f.** VSCode API 参考文档，提供 VSCode 扩展 API 使用的详细说明。
- **g.** Embedding 模型使用手册，介绍了 Embedding 模型在代码和文档检索中的应用。

---

## 2. 软件概述

### 2.1 **目标**

ChiikaCode 的目标是为开发者提供一个智能、高效的代码辅助工具，集成代码解释、翻译、注释、自动补全等功能。

通过采用 **检索增强生成**（RAG）技术，ChiikaCode 能够从已有代码库中检索并生成高质量的代码。无论是编写新代码，还是优化现有代码，ChiikaCode 都能够提供高效的代码生成、解释和优化建议。

ChiikaCode 的目标不仅是提升开发者的工作效率，还要通过智能化的功能，帮助开发者编写更具可读性和可维护性的代码，减少冗余代码并避免常见的编码错误。此外，通过智能化的代码生成功能，ChiicaCode 还能够帮助开发者在项目级别自动化生成代码结构，从而加速开发流程。

### 2.2 **功能**

ChiikaCode 提供一系列功能，旨在帮助开发者提高编码效率、代码质量和开发体验。以下是 ChiikaCode 提供的主要功能：

- **代码解释**：  
  对选中的代码片段进行详细解释，帮助开发者理解代码的功能、流程和实现细节。无论是复杂的算法，还是简单的功能实现，ChiickaCode 都能够提供清晰的解释，帮助用户快速掌握代码的核心逻辑。

- **代码注释**：  
  自动为代码生成详细的注释，解释函数、类、变量的用途和实现细节。ChiikaCode 能识别代码结构并生成符合文档标准的注释，确保代码具有良好的可读性和维护性，便于开发者和团队成员理解代码逻辑。

- **代码修复**：  
  自动检测代码中的错误并提供修复建议。ChiikaCode 能识别语法错误、逻辑错误等常见问题，并提出修复方案。对于复杂问题，ChiikaCode 会建议最佳修复方法，帮助开发者快速定位并解决代码中的问题。

- **自动补全**：  
  智能预测并补全代码。ChiikaCode 能根据上下文自动补全变量名、函数名、类名等代码元素，极大提高编写速度并减少常见的输入错误。无论是在函数内部，还是在类和模块之间，自动补全都能帮助开发者快速编写高质量代码。

- **项目级别代码生成**：  
  通过 RAG 方法，结合项目需求自动生成符合规范的代码结构。在开发项目时，ChiikaCode 可以根据项目需求和现有的代码库，自动生成所需的代码框架和功能模块，减少重复劳动，帮助开发者专注于核心功能的实现。

- **RAG（检索增强生成）**：  
  利用 **RAG** 方法，ChiikaCode 能结合项目需求和已有的代码库进行智能化的代码生成。RAG 方法通过检索项目中的相关代码或文档，并结合生成模型，为开发者提供更高质量、更符合需求的代码,，提升开发效率，并确保生成的代码与现有项目兼容。

- **Web 前端支持**：  
  提供 Web 界面，支持所有上述功能，方便不使用 VSCode 的用户进行访问和操作,帮助用户在不同环境下使用该工具，提高工作效率。

### 2.3 **性能**

ChiikaCode 致力于提供高效且精确的代码辅助服务，在使用过程中注重性能表现，以确保开发者能够快速获得准确的反馈。以下是 ChiikaCode 在多个维度上的性能特性：

#### **a. 数据精确度**

- **输入数据处理**：  
  ChiikaCode 使用先进的自然语言处理技术对用户输入的代码进行精准解析。无论是代码片段、注释、命令还是上下文信息，系统能够高效理解并处理输入数据，确保后续操作基于正确的信息进行。
  
- **输出准确性**：  
  系统结合上下文信息，确保生成的代码不仅能够正常运行，还具备较高的代码质量和可读性。

- **多语言支持**：  
  ChiikaCode 提供多语言支持，能够处理多种编程语言的代码解析、翻译和生成。无论是 Python、Java、JavaScript、C++ 还是其他编程语言，系统都能保证高精度的解析和准确的输出。

#### **b. 时间特性**

- **响应时间**：  
  ChiikaCode 在处理用户提问时，确保响应时间尽可能短。一般情况下，系统响应时间控制在 5 秒以内，能够快速反馈用户的操作请求，保证开发者的工作流不中断。
  
- **处理时间**：  
  对于复杂的代码生成和推理任务，ChiikaCode 的处理时间通常在 60 秒左右，复杂的代码逻辑或大规模的代码库分析可能会稍长。

- **数据传输时间**：  
  在使用 **大语言模型 API** 或云端服务时，数据传输的时间依赖于网络状况。通常情况下，数据的传输时间保持在 500 毫秒以内，保证云端服务的响应及时性。

#### **c. 灵活性**

- **操作方式**：  
  ChiikaCode 提供了多种操作方式，以适应不同用户的使用习惯。用户可以通过快捷键、命令面板、右键菜单等多种方式访问功能，极大提升了用户操作的便捷性。

- **跨平台兼容性**：  
  ChiikaCode 支持在 **Windows**和 **Linux** 操作系统上运行，确保用户在主流平台上能够流畅使用。无论是个人开发者、团队协作，还是企业级部署，ChiikaCode 都能够提供稳定的跨平台支持，确保在不同操作系统下的功能一致性和性能表现。

#### **d. 安全性与隐私保护**

- **本地模型支持**：  
  ChiikaCode 提供本地模型支持，允许用户在没有网络连接的情况下进行离线工作。通过本地运行模型，用户可以完全控制自己的数据，避免敏感信息泄露的问题。特别适用于对隐私要求较高的企业或开发者。

---

## 3. 运行环境

### 3.1 **硬件**

- **计算机型号**：支持 x86 和 ARM 架构的计算机。
  无论是台式机、笔记本或基于 ARM 的设备（如 Raspberry Pi 或某些 Mac），都可以运行该工具，只要系统符合其他要求。
  
- **主存容量**：
  - 最低要求：8GB RAM。
    足够支持基本的插件操作和小型项目的处理。
  - 推荐配置：16GB 及以上，以保证流畅运行本地模型和处理大型项目时的性能。
    对于较大的项目、复杂的代码生成和本地模型操作，16GB 或更多内存将显著提高性能，减少延迟。

- **外存储器**：
  - **硬盘空间**：至少 20GB 可用空间。  
    确保有足够的空间来存储项目文件、缓存、模型和插件等。较大的项目可能需要更多空间。
  - **媒体**：支持 SSD 或 HDD。
    推荐使用 SSD 以提升读写速度，特别是在处理大型文件时，HDD 也可以工作，但可能会影响性能。

- **输入/输出设备**：
  - 标准键盘、鼠标和显示器。
    不要求特殊的硬件，任何标准的输入输出设备均能满足要求。

- **网络设备**：
  - **网络连接**：用于访问大语言模型 API，需要稳定的网络连接。  
    使用在线大语言模型时，网络速度和稳定性直接影响响应时间和用户体验。建议使用高速、稳定的网络连接。

### 3.2 **支持软件**

- **操作系统**：
  - **Windows**：Windows 10 及以上版本。  
    ChiikaCode 完全兼容主流的 Windows 版本，确保用户能够无缝安装和运行插件。
  - **Linux**：Ubuntu 18.04 及以上版本，或其他主流发行版。  
    对于 Linux 用户，ChiikaCode 提供广泛的兼容性，建议使用 Ubuntu 或其他流行发行版。

- **VSCode**：Visual Studio Code 版本 1.50 及以上。  
  ChiikaCode 插件需要 VSCode 1.50 或更新版本才能运行，确保兼容性和插件稳定性。

- **语言编译系统**：
  - **Node.js**：用于插件运行，版本 12 及以上。  
    ChiikaCode 插件基于 Node.js 构建，确保插件的后台功能能够顺利运行。推荐使用版本 12 或更高。
  - **Python**：用于本地模型支持，版本 3.7 及以上。  
    本地模型支持需要 Python 环境，建议使用版本 3.7 及以上，以确保所有功能的兼容性和运行稳定性。

- **其他必要的支持软件**：
  - **Git**：版本控制系统。  
    用于管理代码的版本控制，确保在开发过程中代码能够高效且有序地进行管理。安装 Git 是必需的。
  - **NPM 或 Yarn**：包管理工具。  
    用于管理插件依赖的 Node.js 包，确保插件和相关依赖项能够正确安装和运行。

---

## 4. 使用说明

### 4.1 **安装和初始化**

- **Github 克隆**：
  - 在 Github 上找到 ChiikaCode 项目，通过'code'按钮获取项目链接
  - 终端输入 git clone '项目链接' 将项目克隆到本地
- **pnpm 配置**：
  - 下载 Nodejs ，并安装 pnpm
  - 终端输入 pnpm install 下载必要的环境
  - 终端输入 pnpm build 编译环境 
- **ollama 配置**：
  - 下载 ollama 开源项目，地址为：https://github.com/ollama/ollama/blob/main/README.md
  - 终端输入 ollama pull qwen:7b 与 ollama pull llama3.2:latest 下载 ollama 模型
- **python 库安装**：
  - 安装 apis\requirements.txt 中的所有库，可通过终端输入 pip install -r apis\requirements.txt 实现
  - 建议配置 conda 虚拟环境，避免不同项目间的依赖冲突

### 4.2 **代码输入**

#### 4.2.1 **数据背景**

- **数据来源**：用户在编辑器中输入的代码、指令或自然语言文本。
- **存储媒体**：所有输入数据都存储在内存中并即时处理，不会被永久存储，，以便提供即时反馈或生成代码。
- **出现频度**：用户的输入频率直接影响插件的响应。每次用户输入新的代码或指令，插件会实时解析并生成输出。
- **限制和质量管理**：为了确保插件能够正确处理输入内容，用户输入的代码或文本应符合编程语言的语法和规范。插件不会处理包含语法错误或不符合标准格式的输入，用户应在输入前确保代码的有效性和清晰性。

#### 4.2.2 **数据格式**

- **长度**：输入的代码行数没有严格限制，用户可以输入任意长度的代码片段。但过长的代码段可能影响性能，尤其是在处理复杂代码时。
- **格式基准**：输入的代码应遵循 Visual Studio Code 的格式化标准。VSCode 提供了代码自动格式化功能，用户可以通过插件或手动操作确保代码格式正确、整齐。格式化标准包括合理的缩进、空格和换行符的使用。
- **标号**：代码中的函数、变量、类、常量等应使用明确且具有描述性的命名。良好的命名规范有助于插件理解代码逻辑并生成更准确的建议。
- **顺序**：输入的代码应按照逻辑顺序排列，确保代码的执行顺序符合预期。
- **分隔符**：在代码中使用适当的分隔符（如空格、缩进、换行符）以提高代码的可读性。
- **词汇表**：输入时应使用编程语言的标准关键字和库函数。插件能够识别常见编程语言（如 JavaScript、Python、Java 等）的关键词，并基于这些关键字生成代码建议。用户应避免使用自定义的、未定义的词汇，除非该词汇在当前上下文中已被定义。
- **省略和重复**：用户应避免输入重复的代码段。重复代码会增加插件处理的负担，也可能导致不必要的错误提示。对于尚未完成的代码块，用户可以使用占位符（例如 `TODO`）来表示需要进一步补充的部分。
- **控制结构**：输入时应遵循编程语言的控制结构，插件会基于这些结构提供优化建议或生成相应的代码片段。

### 4.3 **输出**

#### 4.3.1 **数据背景**

- **输出数据的去向**：输出的数据会直接显示在 VSCode 的编辑器或输出面板中，确保用户能够方便地查看生成的内容。
- **使用频度**：输出内容与用户输入操作的频率密切相关。每当用户请求代码解释、生成、自动补全等功能时，都会产生相应的输出。
- **存放媒体**：输出的数据首先存储在内存中，用户可以选择将生成的内容保存为文件，以便进一步处理或使用。

#### 4.3.2 **数据格式**

- **首部**：输出的首部一般包含生成内容的标题或相关提示信息。它帮助用户理解输出内容的上下文，明确该输出对应的是哪种功能的结果。
- **主体**：主体部分是输出的核心内容，包括生成的代码、代码的解释或添加的注释。这是用户与系统交互的主要内容。
- **尾部**：输出的尾部通常包含附加的建议、警告或提示信息。尾部内容旨在帮助用户进一步理解输出或改进输入内容。

### 4.4 **出错和恢复**

在使用 ChiikaCode 时，可能会遇到一些常见的错误和问题。为确保用户能够顺利恢复，以下列出了常见的错误信息及其含义，以及用户应采取的措施。

- **网络错误**：
  - **描述**：无法连接到大语言模型 API 服务，可能是由于网络问题导致无法访问在线服务。
  - **常见原因**：
    - 网络不稳定，或者暂时失去互联网连接。
    - API 服务端发生故障或暂停服务。
  - **解决办法**：检查网络连接是否正常，尝试重新连接互联网。如果问题持续存在，可以检查 API 服务的状态，或者等待服务恢复。

- **模型加载错误**：
  - **描述**：本地模型文件无法加载或文件损坏，导致无法启动本地模型的辅助功能。
  - **常见原因**：
    - 本地存储的模型文件缺失、路径错误或损坏。
    - 模型文件的格式不正确，或者与插件版本不兼容。
  - **解决办法**：确认本地模型文件的路径配置是否正确，确保文件存在且未损坏。如果需要，可以重新下载或重新配置本地模型文件。

- **无效输入**：
  - **描述**：用户输入的代码存在语法错误、格式问题，或者输入的编程语言不被支持。
  - **常见原因**：
    - 输入的代码存在拼写错误、缺少必要的符号或不符合编程语言的语法规范。
    - 插件不支持某些特定的编程语言或语言特性。
  - **解决办法**：检查输入的代码，确保符合目标编程语言的语法规范。若使用的是不被支持的语言，可以尝试切换到支持的语言，或者通过其他方式进行处理。

- **404 错误**：
  - **描述**：请求的资源未找到，通常发生在 API 请求时，插件无法从服务器获取所需数据。
  - **常见原因**：
    - 本地模型没有启动或未加载，导致插件无法提供相关功能。
  - **解决办法**：确保本地模型已经成功启动并正确配置。检查本地模型的路径和配置，确认模型已经正确加载并在本地环境中运行。

- **500 错误**：
  - **描述**：服务器内部错误，通常发生在本地环境配置不正确时，导致模型无法正常加载或运行。
  - **常见原因**：
    - 环境未正确配置，如依赖软件包缺失或版本不兼容。
    - 本地模型未正确加载或缺少必要的配置文件。
    - Python 环境、Node.js 或其他所需工具未正确安装。
  - **解决办法**：检查本地环境配置，确保所有依赖项都已正确安装并且版本匹配。可以查看安装日志并根据提示更新或重新安装必要的依赖，或者根据文档检查所需的环境配置是否完整。

---

## 5. 运行说明

### 5.1 **运行表**

| 运行情况             | 运行目的                        |
| -------------------- | ------------------------------ |
| 初次安装后启动插件   | 初始化插件，开始使用功能           |
| 使用本地模型进行辅助 | 离线模式下提供RAG与项目级代码生成   |
| 启动 Web 前端       |  在浏览器中使用 ChiikaCode 功能    |

### 5.2 **运行步骤**

#### 5.2.1 **运行控制**

- **运行本地模型**：
  - 终端输入cd apis进入 api 文件夹
  - 终端输入 uvicorn generate_code_api:app --host 127.0.0.1 --port 8000 运行生成代码 api
  - 终端输入 uvicorn rag_api --host 127.0.0.1 --port 8001 运行 RAG api
- **运行插件**
  - 点击F5运行

#### 5.2.2 **操作信息**

- **运行目的**：提供代码辅助、RAG和项目级别代码生成功能。
  
- **操作要求**：  
  - 确保已正确安装并配置 ChiikaCode 插件。  
  - 配置本地模型路径，或提供有效的大语言模型 API 密钥。  
  - 如果使用本地模型，确保已启动本地模型服务并正确配置路径。  
  - 确保网络连接稳定，以便使用在线功能，如大语言模型 API 。

- **启动方法**：  
  - 若仅需代码辅助功能，可直接按F5运行。
  - 若还需RAG与项目级代码生成功能，则运行本地模型后按F5运行。

- **预计运行时间**：  
  - 本地模型可于5s内运行成功。
  - 插件可于30s运行成功  
  - 代码解释、自动补全等功能在用户输入后会迅速响应。  
  - 生成项目级别的代码或进行复杂查询时，响应时间可能会稍长，一般在1分钟左右。

- **操作命令格式及格式说明**：  
  - 用户可以通过侧边栏或右键菜单栏调用插件功能。  
  - 用户可按Tab键接受代码补全内容。

- **其他事项**：  
  - 为确保最佳体验，请确保网络连接稳定，特别是在使用在线大语言模型 API 时。  
  - 在本地模型模式下，确保模型文件已经加载并且路径配置正确。  
  - 在生成项目级别代码时，确保项目文件和需求描述清晰，以便 RAG 模型能够准确生成相关代码。

#### 5.2.3 **输入/输出文件**

- **文件名称及编号**：  
  - 插件不对用户项目中的文件名称和编号有任何特殊要求。用户可以根据自身需求自由命名代码文件。  
  - 插件会读取和生成用户项目中的代码文件，支持多种主流编程语言格式，如 `.py`、`.js`、`.cpp` 等。

- **记录媒体**：  
  - 所有输入和输出的文件数据均存储在本地硬盘或 SSD 中，确保文件的持久化存储。

- **存留的目录**：  
  - 用户可以自由选择工作目录，插件默认在用户项目的根目录下运行。  
  - 所有生成的文件（如自动生成的代码、注释或日志）都会保存在项目所在目录内，用户可在文件管理器中查看和修改。

- **文件的支配**：  
  - 所有输入和输出的文件由用户自行管理。插件不会自动修改用户文件内容。  
  - 插件通过在 VSCode 编辑器中提供实时反馈和建议来辅助用户进行代码优化和修改，所有修改操作均由用户确认后进行。  
  - 插件的作用仅限于提供辅助建议、代码生成和自动补全，所有文件操作由用户自己执行。

### 5.2.4 **错误处理过程**

- **重新运行插件**：  
  - 如果插件在使用过程中异常关闭，可关闭原来的终端，按F5重新运行插件。

- **检查错误日志**：  
  - 当插件无法正常工作时，首先检查 VSCode 的输出面板，查看插件的错误日志。错误日志通常会提供有关问题的详细信息，包括错误类型、发生的时间和可能的原因。  
  - 根据错误日志中的提示，采取相应的修复措施，例如网络问题、配置错误或模型加载失败。

- **重新安装插件**：  
  - 如果通过查看错误日志后仍无法解决问题，尝试重新安装插件。卸载插件后重新安装，可以确保插件文件未损坏，并重置插件的配置。  
  - 卸载步骤：删除整个ChiikaCode文件夹。  
  - 重新安装：在Github界面重新clone。

---

## 6. 操作命令一览表

- **代码解释**：
  - **命令**：右键菜单栏`Explain Code`或侧边栏输入
  - **功能**：对选中的代码进行详细解释，帮助开发者理解其功能和实现细节。

- **代码注释**：
  - **命令**：右键菜单栏`Document Code`或侧边栏输入
  - **功能**：为选定的代码段生成详细的注释，解释各个函数、变量的作用以及代码逻辑。

- **代码修复**：
  - **命令**：侧边栏输入
  - **功能**：检测并修复代码中的错误，包括语法错误、逻辑错误和其他常见问题。

- **自动补全**：
  - **命令**：Tab键接受
  - **功能**：根据代码上下文自动补全变量名、函数名等，提升编码速度并减少输入错误。

- **项目代码生成**：
  - **命令**：侧边栏生成
  - **功能**：根据项目需求自动生成符合规范的代码结构和模块，减少重复劳动。

- **RAG（检索增强生成）**：
  - **命令**：侧边栏导入文件/文件夹并提问
  - **功能**：通过检索项目相关的代码和文档，并结合生成模型，提供高质量、符合项目需求的代码。

---

## 7. 用户操作举例

### 示例 1：使用代码解释功能

1. 在 VSCode 中打开一个 JavaScript 文件。
2. 选中需要解释的代码片段。
3. 按下鼠标右键，选择`Explain Code`，然后按下回车键。
4. 在输出面板中查看 ChiikaCode 提供的详细代码解释，帮助理解代码的功能和实现逻辑。

### 示例 2：使用自动补全功能

1. 编写一段不完整的代码。
2. 在编写过程中会出现浅灰色字体，展示代码补全结果。
3. 按Tab键可接受补全结果。

### 示例 3：使用项目级别代码生成

1. 在侧边栏输入框中填写项目需求描述，例如 “创建一个贪吃蛇项目”。
2. 点击 “生成项目” 按钮。
3. ChiicaCode 根据输入的项目需求自动生成符合规范的代码结构，用户可以在项目目录中查看生成的代码文件和模块，从而快速搭建项目基础。
4. 生成的项目文件会创建在工作区中并自动打开，用户可自己选择保存或删除。